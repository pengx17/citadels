<dom-module id="cita-round-roller">
  <template>
    <style>
      :host {
        height: 100%;
        width: 100%;
      }

      #roundRollerContainer {
        display: inline-block;
        overflow-y: hidden;
        position: relative;
        height: 475px;
      }

      #roundIndicator {
        position: absolute;
        top: 52px;
        left: 0;
        width: 50px;
        height: 50px;
        box-shadow: 0 0 5px #000, inset 0 0 15px #000;
      }

      .round-container {
        width: 50px;
        height: 50px;
        transition: transform ease 1s;
        margin-bottom: 2px;
        box-shadow: 0 0 5px #333;
        /* For testing */
        text-align: center;
        line-height: 50px;
      }
    </style>

    <div id="roundRollerContainer">
      <template is="dom-repeat" items="{{_rounds}}">
        <div class="round-container">
          {{item.label}}
        </div>
      </template>
      <div id="roundIndicator"></div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: "cita-round-roller",

    properties: {
      // The current round value should be synced via a firebase reference
      currentRound: Number,
      _rounds: {
        type: Array,
        value: []
      }
    },

    ready: function() {
      var self = this;

      this.currentRound = 0;

      this.set('_rounds', this._generateRounds(this.currentRound));

      // iterate over the rounds automatically for testing
      setInterval(function() {
        self.nextRound();
      }, 1000);
    },

    /**
     * Move to next round and animate
     */
    nextRound: function() {
      var self = this;

      $('.round-container:first-child').animate({
        marginTop: "-=50px"
      }, function() {
        self.push('rounds', self.shift('rounds'));
        $('.round-container:first-child').css({
          marginTop: "0px"
        });
      });
    },

    /**
     * 0 -> start, 9 -> end
     * 1 ~ 8
     */
    _generateRounds: function(currentRound) {
      var self = this;
      var rounds = [];

      for (var i = 0; i < 10; i++) {
        rounds.push(this._generateRoundObject((currentRound + i + 9) % 10));
      }
      return rounds;
    },

    /**
     * Utility function to generate a round object based on the round key
     * 0 -> start, 9 -> end
     */
    _generateRoundObject: function(key) {
      var label;

      if (key === 0) {
        label = 'start';
      } else if (key === 9) {
        label = 'end';
      } else {
        label = key;
      }
      return {
        key: key,
        label: label
      };
    }
  });
</script>
